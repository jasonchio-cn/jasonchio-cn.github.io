@startuml 假维斯工作流程

title 假维斯工作流程

:唤醒小爱;
:轮询小爱音箱的对话列表，获取最新对话;
:捕捉对话内容中的唤醒词，进入唤醒模式;
:构建Prompt、加载对话记忆;
:构建大模型请求参数;
:请求大模型接口;
:处理流式响应，持续回调;
:切割响应文本，构建小爱音箱的回复;
:调用TTS指令播放回复;
:判断是否播放完毕，是则播放下一句回复;
:全部回复播放完毕，调用唤醒指令，使小爱音箱持续对话;
:等待提问超时，则退出唤醒状态;

@enduml